# Virtualización y Procesamiento Distribuido
## Práctica 3: Recursos de almacenamiento virtual

**Práctica 3: Recursos de almacenamiento virtual**

El objetivo de esta actividad es saber integrar recursos de almacenamiento en los sistemas invitados. [cite: 2]

## 1 Introducción

El objetivo fundamental de esta actividad es que el estudiante sea capaz de poner a disposición de los sistemas invitados recursos de almacenamiento, tanto si provienen de recursos físicos de almacenamiento local integrados en el sistema anfitrión (discos duros, particiones de disco, etc...) como si provienen de equipos remotos dedicados a proporcionar servicios de almacenamiento. [cite: 3]

## 2 Requisitos previos

Para abordar esta práctica se debe haber completado la práctica 1 (Instalación de KVM. Creación e instalación de máquinas virtuales). [cite: 6]

## 3 Plan de actividades y orientaciones

Como paso previo a la realización de las tareas de esta práctica deberá crear una nueva máquina virtual, llamada mvp3. [cite: 7] Esta nueva máquina virtual deberá ser el resultado de la clonación de la máquina virtual creada en la práctica 1 (mvp1). [cite: 8] Realice esta clonación de manera que la interfaz de red de mvp3 posea una dirección MAC diferente a la que posee la interfaz de red de mvp1. [cite: 9]

### 3.1 Contenedores locales

**Tarea 1: crear un nuevo volumen de 1GB con nombre "Vol1_p3" de tipo "raw" en el contenedor por defecto y asociarlo a la máquina mvp3**

El nuevo volumen debe cumplir con los siguientes requisitos:

* Nombre: Vol1_p3 [cite: 10]
* Tipo: volumen virtual de disco tipo "raw" [cite: 10]
* Tamaño: 1 Gbyte [cite: 10]
* Ubicación: contenedor por defecto de volúmenes virtuales del sistema [cite: 10]

La creación de un nuevo volumen en el contenedor por defecto y su asociación a una MV se puede realizar desde el panel de administración de hardware de la MV proporcionado por virt-manager. [cite: 10] También se puede realizar mediante el shell ayudándonos de las siguientes órdenes (optativo):

* virsh vol-create-as: para la creación del fichero que representa el disco. [cite: 12]
* virsh: empleando las opciones attach-device o attach-disk. [cite: 13]

El nuevo volumen se deberá asociar a la máquina virtual mvp3 y conectarse al bus SATA de dicha máquina. [cite: 13] Para verificar que el nuevo volumen está operativo en la máquina mvp3, deberá:

* Crear en el volumen la partición número 1, estableciéndole un tamaño de 512 Mbytes. [cite: 14]
* En la nueva partición creada, crear un sistema de archivos de tipo XFS. [cite: 15]
* En el sistema de archivos creado, crear un archivo de nombre test.txt. [cite: 16]

**Tarea 2: crear una nueva partición en el host anfitrión y asociarla a la máquina mvp3**

En esta tarea se debe crear una partición en un disco que contiene particiones utilizadas por otros estudiantes de esta y otras asignaturas. [cite: 17] Por tanto, si no se hace correctamente puede dañar el sistema. [cite: 18] No realice esta tarea hasta estar seguro de cómo se particionan unidades de disco. [cite: 19] Además, es muy importante que tome nota de su partición de trabajo. [cite: 20]

El objetivo de esta segunda tarea es ofrecer a un sistema invitado la posibilidad de trabajar directamente sobre una partición de un disco físico del sistema anfitrión. [cite: 21] Para realizar esta tarea deberá crear una partición lógica nueva de 1GB. [cite: 22] Para ello puede emplear la utilidad fdisk. [cite: 22] Recuerda tomar nota de la partición creada y así evitar que puedas dañar la partición creada por otro estudiante. [cite: 23]

Dependiendo del laboratorio de trabajo, te podrás encontrar con dos configuraciones:

* En los laboratorios LQ-C (E07) y LQ-D (E08), los equipos tienen un único disco y la nueva partición lógica se debe crear en la partición extendida que posee el disco (/dev/sda), donde se dispone de suficiente espacio libre. [cite: 24]
* En los laboratorios LQ-1 (D07) y LQ-2 (D08), los equipos disponen de dos discos y la nueva partición lógica se debe crear en la partición extendida que posee el disco secundario (/dev/sdb), donde se dispone de suficiente espacio libre. [cite: 25]

Una vez creada la partición deberá emplear la orden "virsh" con las opciones attach-device o attach-disk para asociarla a la máquina mvp3. [cite: 26] La partición deberá aparecer en la máquina mvp3 como el disco sdb. [cite: 27] Para verificar que el nuevo volumen sdb está operativo en la máquina mvp3, deberá:

* Sin particionar el disco sdb, crear en dicho disco un sistema de archivos de tipo XTS. [cite: 28]
* En el sistema de archivos creado, crear un archivo de nombre test.txt. [cite: 29]

**Tarea 3: crear un contenedor (storage pool) en una partición lógica del disco del sistema anfitrión**

El objetivo de esta tarea es crear un contenedor de almacenamiento donde poder crear volúmenes (discos virtuales) para los sistemas invitados. [cite: 30] Para realizar esta tarea deberá crear una partición lógica nueva de 2GB. [cite: 31] Para ello puede emplear la utilidad fdisk. [cite: 31] Recuerde tomar nota de la partición creada y así evitar que pueda dañar la partición creada por otro estudiante. [cite: 32]

Dependiendo del laboratorio de trabajo te podrás encontrar con dos configuraciones:

* En los laboratorios LQ-C (E07) y LQ-D (E08), los equipos tienen un único disco y la nueva partición lógica se debe crear en la partición extendida que posee el disco (/dev/sda), donde se dispone de suficiente espacio libre. [cite: 33]
* En los laboratorios LQ-1 (D07) y LQ-2 (D08), los equipos disponen de dos discos y la nueva partición lógica se debe crear en la partición extendida que posee el disco secundario (/dev/sdb), donde se dispone de suficiente espacio libre. [cite: 34]

Una vez creada la partición, cree en ella un sistema de archivos de tipo ext4 y a continuación cree un contenedor con el nombre "Contenedor_Particion". [cite: 35] Este nuevo contenedor debe mapearse al directorio /var/lib/libvirt/Pool_Particion. [cite: 36] Para ello puede emplear el virt-manager o bien la utilidad de línea de órdenes virsh (optativo). [cite: 36]

Una vez creado el contenedor de almacenamiento, crear un volumen nuevo en dicho contenedor llamado "Vol2_p3", cumpliendo los siguientes requisitos:

* Nombre: Vol2_p3 [cite: 37]
* Tipo: volumen virtual de disco tipo "qcow2" [cite: 37]
* Tamaño: 1 Gbyte [cite: 37]
* Ubicación: en el contenedor "Contenedor_Particion" [cite: 37]

Añadir el nuevo volumen creado a la máquina mvp3 de forma que se pueda emplear como espacio de almacenamiento. [cite: 37] Para ello, el nuevo volumen virtual de disco se debe añadir como volumen de disco paravirtualizado en la máquina mvp3, debiendo aparecer en dicha máquina como disco vdb. [cite: 38] Para verificar que el nuevo volumen vdb está operativo en la máquina mvp3, deberá:

* Sin particionar el disco vdb, crear en dicho disco un sistema de archivos de tipo XFS. [cite: 39]
* En el sistema de archivos creado, crear un archivo de nombre test.txt. [cite: 40]

Además, deberá realizar la configuración necesaria para que el volumen se monte de forma automática en el arranque de la máquina mvp3 en el directorio /VDB. [cite: 41]

### 3.2 Contenedores en Red

**Tarea 4: crear un contenedor NFS de imágenes ISO para realizar instalaciones del sistema operativo en las máquinas virtuales**

En prácticas anteriores se ha empleado un servicio NFS que contiene imágenes de sistemas operativos para su instalación en máquinas virtuales. [cite: 43] En este apartado se propone como ejercicio crear un nuevo contenedor de tipo NFS. [cite: 44] Mediante este nuevo contenedor se deberá tener acceso a las imágenes ISO de las instalaciones de las distintas distribuciones Fedora exportadas por el servidor disnas2.dis.ulpgc.es. [cite: 45]

Los datos requeridos para agregar este nuevo contenedor de almacenamiento compartido al sistema anfitrión son los siguientes:

* Nombre del contenedor: CONT_ISOS_COMP [cite: 46]
* Ruta del directorio local asociado al contenedor: /var/lib/libvirt/images/ISOS [cite: 46]
* Servidor NFS: disnas2.dis.ulpgc.es [cite: 46]
* Ruta del directorio exportado por el servidor NFS: /imagenes/fedora/41/isos/x86_64 [cite: 46]

El contenedor NO DEBE ACTIVARSE AUTOMÁTICAMENTE con el arranque del sistema. [cite: 46]

**Tarea 5: crear un contenedor NFS para volúmenes de máquinas virtuales**

Un escenario habitual de producción en entornos de virtualización es disponer de un conjunto de servidores de virtualización que emplean un servidor común de almacenamiento para proporcionar espacio a las máquinas virtuales. [cite: 47] En este apartado de la práctica se propone añadir un contenedor de tipo NFS al host anfitrión que funcione como contenedor de volúmenes de máquinas virtuales. [cite: 48]

Los datos requeridos para crear este nuevo contenedor de espacio de almacenamiento compartido son los siguientes:

* Nombre del contenedor: CONT_VOL_COMP [cite: 49]
* Ruta del directorio local asociado al contenedor: /var/lib/libvirt/images/COMPARTIDO [cite: 49]
* Servidor NFS: disnas2.dis.ulpgc.es [cite: 49]
* Ruta del directorio exportado por el servidor NFS: /disnas2-itsi [cite: 49]

El contenedor NO DEBE ACTIVARSE AUTOMÁTICAMENTE con el arranque del sistema. [cite: 49]

Deberá crear un volumen llamado "pcHOST_LQX_ANFITRIONY_Vol3_p3" en dicho contenedor de tamaño 1GB, de tipo "qcow2". [cite: 50] Añadir el nuevo volumen creado a la máquina mvp3 como volumen de disco paravirtualizado, debiendo aparecer en la máquina mvp3 como el disco vdc. [cite: 51] Para verificar que el nuevo volumen vdc está operativo en la máquina mvp3, deberá:

* Sin particionar el disco vdc, crear en dicho disco un sistema de archivos de tipo XFS. [cite: 52]
* En el sistema de archivos creado, crear un archivo de nombre test.txt. [cite: 53]

Además, deberá realizar la configuración necesaria para que el volumen se monte de forma automática en el arranque de la máquina mvp3 en el directorio /VDC. [cite: 54]

## 4 Checklist

Cuando finalice las tareas, los profesores de la asignatura realizarán las siguientes comprobaciones:

* Verificación de que el espacio de almacenamiento definido en cada apartado es accesible desde la máquina mvp3 y que se ha almacenado información en dicho espacio de almacenamiento. [cite: 59]

## 5 Entrega

Se debe entregar una ficha que contenga todos los pasos y órdenes que ha necesitado para realizar las cinco tareas indicadas de esta práctica. [cite: 60]

## 6 Rúbrica de evaluación

Los/as estudiantes deberán validar el trabajo realizado en esta práctica ante su profesor/a de prácticas, preferiblemente durante el horario de prácticas de laboratorio. [cite: 61] Será responsabilidad de los/as estudiantes concertar una cita con el/la profesor/a correspondiente si desean realizar la defensa en otro momento. [cite: 62]

* Un estudiante obtendrá una calificación de 7 en esta práctica si realiza las tareas propuestas con el virt-manager, supera la validación de la misma y además entrega el informe que contiene las evidencias del trabajo realizado dentro del plazo estipulado. [cite: 62]
* Un estudiante obtendrá una calificación de 8 en esta práctica si realiza las tareas propuestas con el virt-manager y con órdenes, supera la validación de la misma y además entrega el informe que contiene las evidencias del trabajo realizado dentro del plazo estipulado. [cite: 63]
* Un estudiante obtendrá una calificación de 10 en esta práctica si realiza las tareas propuestas con el virt-manager y con órdenes, supera la validación de la misma, entrega el informe que contiene las evidencias del trabajo realizado dentro del plazo estipulado y además, en dicho informe se explican los parámetros y el sentido de cada una de las órdenes que se emplean para desarrollar cada una de las tareas. [cite: 64]

Por otro lado, si un estudiante concluye las tareas de esta práctica obligatoria de forma satisfactoria en las sesiones oficialmente programadas para su desarrollo por el equipo docente (3 sesiones en el caso de esta práctica), el estudiante obtendrá una calificación acumulable en el ítem de "Participación activa" que se explica en el proyecto docente de 0,143. [cite: 66] La correcta culminación de las tareas será verificada por el profesor responsable en la última sesión de la práctica, no incluyéndose la realización del informe de la práctica. [cite: 67]
